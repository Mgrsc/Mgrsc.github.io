<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Docker | Herbal's Lover</title><meta name="author" content="Mgrsc"><meta name="copyright" content="Mgrsc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="高效，简单的沙盒技术，data+process&#x3D;image">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker">
<meta property="og:url" content="http://mgrsc.github.io/undefinedDocker-0/index.html">
<meta property="og:site_name" content="Herbal&#39;s Lover">
<meta property="og:description" content="高效，简单的沙盒技术，data+process&#x3D;image">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-03-21%20161354.png">
<meta property="article:published_time" content="2023-03-21T08:14:37.000Z">
<meta property="article:modified_time" content="2023-10-10T12:04:36.097Z">
<meta property="article:author" content="Mgrsc">
<meta property="article:tag" content="容器">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="云计算">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-03-21%20161354.png"><link rel="shortcut icon" href="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/c.png"><link rel="canonical" href="http://mgrsc.github.io/undefinedDocker-0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-10 20:04:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3946756_hoh0vr6qygb.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/cat.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon--cool-"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-guozhi"></i><span> 休闲区</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="http://read.艹.love/"><i class="fa-fw iconfont icon-B-zhexuezongjiao"></i><span> 阅读区</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://music.163.com/"><i class="fa-fw iconfont icon-hanbao"></i><span> 听歌区</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://cupfox.app/"><i class="fa-fw iconfont icon-a-1"></i><span> 视频区</span></a></li><li><a class="site-page child" href="/game/"><i class="fa-fw iconfont icon-tubiaozhizuomoban-copy-copy"></i><span> 游戏区</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://voce.esotericism.uk/#/register?magic_token=cefba013a956e0351bbd57a8bcc57aec0c7c789d52ac684ceb19cabd1a5f45c70000000000000600000000000000363334373131850a2164000000000000"><i class="fa-fw iconfont icon-ziyuan1"></i><span> 谈话间</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/img/Circe%20Offering%20the%20Cup%20to%20Ulysses%20by%20John%20William%20Waterhouse,%201891.jpeg"><i class="fa-fw iconfont icon-zhiwuyuan"></i><span> 植物园</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw iconfont icon-food-strawberry"></i><span> 好人区</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="http://chatbbb.esotericism.uk/"><i class="fa-fw iconfont icon--happy"></i><span> chatgpt</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://github.com/Mgrsc"><i class="fa-fw iconfont icon-tianshi"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-03-21%20161354.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Herbal's Lover"><span class="site-name">Herbal's Lover</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon--cool-"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-guozhi"></i><span> 休闲区</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="http://read.艹.love/"><i class="fa-fw iconfont icon-B-zhexuezongjiao"></i><span> 阅读区</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://music.163.com/"><i class="fa-fw iconfont icon-hanbao"></i><span> 听歌区</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://cupfox.app/"><i class="fa-fw iconfont icon-a-1"></i><span> 视频区</span></a></li><li><a class="site-page child" href="/game/"><i class="fa-fw iconfont icon-tubiaozhizuomoban-copy-copy"></i><span> 游戏区</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://voce.esotericism.uk/#/register?magic_token=cefba013a956e0351bbd57a8bcc57aec0c7c789d52ac684ceb19cabd1a5f45c70000000000000600000000000000363334373131850a2164000000000000"><i class="fa-fw iconfont icon-ziyuan1"></i><span> 谈话间</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/img/Circe%20Offering%20the%20Cup%20to%20Ulysses%20by%20John%20William%20Waterhouse,%201891.jpeg"><i class="fa-fw iconfont icon-zhiwuyuan"></i><span> 植物园</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw iconfont icon-food-strawberry"></i><span> 好人区</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="http://chatbbb.esotericism.uk/"><i class="fa-fw iconfont icon--happy"></i><span> chatgpt</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://github.com/Mgrsc"><i class="fa-fw iconfont icon-tianshi"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-21T08:14:37.000Z" title="发表于 2023-03-21 16:14:37">2023-03-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-10T12:04:36.097Z" title="更新于 2023-10-10 20:04:36">2023-10-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Docker"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>容器共享一个操作系统，只隔离了运行环境。</p>
<p>容器运用了集装箱的概念，程序运行的环境（依赖）就是集装箱，里面装载了程序。</p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/v2-907214eadd65987e84a0751c08143f91.jpeg" alt="v2-907214eadd65987e84a0751c08143f91"></p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/v2-0f6ede7f0b920b5d0d5571c937a04838.jpeg" alt="v2-0f6ede7f0b920b5d0d5571c937a04838"></p>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>提供一个简单、轻量的建模方法</p>
<p>职责的逻辑分离：程序开发人员关心容器中运行的程序，运维人员关心容器管理，降低“开发时正常，是运维的问题”的风险。</p>
<p>快速高效的开发生命周期：docker目标缩短代码从开发到测试到部署到上线的周期，让应用程序具备可以移植性，易于构建，并易于协作。</p>
<p>鼓励使用面向服务的架构：docker推荐单个容器运行一个应用程序，这样就形成了一个分布式的应用程序模型。</p>
<h2 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h2><p>容器实际是一种沙盒技术，就是能够像一个集装箱一样把你的应用装起来的技术。应用之间有了边界，不至于互相干扰，也可以方便的搬来搬去，实现了pass的最理想状态。</p>
<p>提供的数据+程序&#x3D;可执行镜像（executable image）</p>
<p>cgroups技术用来制造约束，namespace技术是用来修改进程视图的主要方法。</p>
<h3 id="namespace（隔离）"><a href="#namespace（隔离）" class="headerlink" title="namespace（隔离）"></a>namespace（隔离）</h3><p>在宿主机上运行一个程序系统就会给她分配一个PID，但在docker中运行就会对隔离应用的进程空间动手脚</p>
<p>他只是linux创建新进程的一个可选的参数，Linux系统中创建线程的系统调用是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int pid =clone(main_function, stack_size, SIGCHLD, NULL);</span><br><span class="line">#在参数中指定创建新的进程</span><br><span class="line">int pid =clone(main_function, stack_size, CLONE_NEWPID | SIGCHLD, NULL);</span><br><span class="line">#指定参数后，此时新创建的这个进程将会看到一个全新的进程空间，再这个进程空间里，他的PID是1，但宿主机看到的还是100，多次执行clone（）就会创建多个PID Namespace，在这个namespce里的敬长都会仍未自己是当前容器里的一号进程，他看不到宿主机的进程空间。</span><br></pre></td></tr></table></figure>

<p>除了PID Namespacelinux还有Mount\UTS\IPC\Network和USER这些namespace</p>
<p>Mount namesspace用于让被隔离进程只看得到当前namespace里的挂载点信息，networknamespace让被隔离进程只看得到当前namespoace里的网络设置。</p>
<p>可见容器只是一组特殊的进程，内核时共享的，即容器不能运行windows，windwos的容器不能运行linux。</p>
<p>在linux内核中有很多资源兑现格式不能被namespace化的，比如系统时间，如果容器中调用settimeofday（2）系统调用修改了时间，因为内核共享会导致整个宿主机的时间被修改，因为共享内核也会导致应用暴露攻击面变大。</p>
<p>容器虽然被namespace隔离但是他和其他进程时平等的，所以会共享cpu内存等，会被抢占也会被独占，这显然不符合沙盒，所以使用下面的</p>
<h3 id="Cgroups（限制）"><a href="#Cgroups（限制）" class="headerlink" title="Cgroups（限制）"></a>Cgroups（限制）</h3><p>Linux Cgroups(linux control groups)是linux内核中用来<strong>为进程设置资源限制</strong>的一个重要功能。</p>
<p>防止单个容器耗广物理机性能</p>
<p>Cgroups&#x3D;子系统目录+资源限制文件</p>
<p>linux cgroups最主要的功能是限制一个进程组能够使用的资源上限，包括cpu、内存、磁盘、网络带宽等等。</p>
<p>cgroup还能能够对进程进行优先级设置、审计、以及将进程挂起和恢复等操作。</p>
<p>在linux中，cgroups向用户暴露出来的操作接口是文件系统，他以文件和目录的方式组织在操作系统的&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;。（可以用 mount -t cgroup查看）</p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/image-20221120220329894.png" alt="image-20221120220329894"></p>
<p>在cgroup目录下面有很多文件，下面的这些子目录叫做<strong>子系统</strong>，这些都是这台及其可以被cgroup显示的资源种类。</p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/image-20221116232708676.png" alt="image-20221116232708676"></p>
<p>cgroup的每一项子系统都有其独特的资源限制能力</p>
<p>blkio,为块设备设定I&#x2F;O限制，一般用于磁盘等设备</p>
<p>cpuset,为进程分配单独的cpu核和对应的内存结点</p>
<p>memory，为进程设定内存使用限制</p>
<p>docker在每个子系统下面为每个容器创建一个控制组（目录），在容器启动后把这个进程pid写道对应控制组的tasks文件中即可</p>
<p>写的数由用户决定</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --cpu-period=100000 --cpu-guota=20000 ubuntu /bin/bash</span><br><span class="line">cpu带宽等于quota+period,此处cpu带宽等于100000us(100ms)+20000(20ms)=在每100ms时间里，该控制组限制的进程只能使用20ms的cpu时间，即该进程只能是用到20%的带宽</span><br></pre></td></tr></table></figure>

<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/image-20221120222938705.png" alt="image-20221120222938705"></p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/image-20221120222946788.png" alt="image-20221120222946788"></p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/image-20221120222959287.png" alt="image-20221120222959287"></p>
<p>cgroup对资源限制有很多不足的地方，比如&#x2F;proc文件系统，在容器里面运行top你会发现他显示的是宿主机的，因为&#x2F;proc文件系统不知道用户通过cgroups给这个容器进行了限制，即&#x2F;proc不了解cgroups限制的存在。</p>
<h3 id="rootfs"><a href="#rootfs" class="headerlink" title="rootfs"></a>rootfs</h3><p>容器镜像，根文件系统</p>
<p>创建新进程时候，mount namespace修改的是容器进程对文件系统挂载点的认知，这也意味着只有在挂载这个操作发生之后（即重新挂载），进程的视图才会改变，否则新创建的容器和其他进程一样直接继承宿主机的各个挂载点。</p>
<p>mount namespace跟其他的namespace略有不同就是：他对容器进程视图的改变一定要伴随着挂在操作才能生效。</p>
<p>可是我们希望没创建一个新的容器时，容器进程看到的文件系统就是一个独立的环境，而不是继承，那么我们可以在容器进程启动之前重新挂载他的整个根目录&#x2F;，而由于mount namespace的存在这个挂载对于宿主不可见，容器可以随便倒腾。</p>
<p>chroot可以改变进程的根目录，mount namespace就是基于chroot改良过来。</p>
<p>change root file system 改变进程根目录到指定位置</p>
<p>为了让容器的根目录看起来更真实一般会在这个容器的根目录下挂载一套完整的操作系统的文件系统。</p>
<p>这个挂载在容器根目录上用来为容器进程提供隔离后执行环境的文件系统，就是所谓的“容器镜像”。他的另一个名字就叫rootfs（根文件系统），它不包含内核，rootfs只是一个操作系统所包含的文件、配置和目录。</p>
<p>一个常见的rootfs包括以下目录</p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/image-20221121010708835.png" alt="image-20221121010708835"></p>
<p>rootfs给了容器：一致性</p>
<p>rootfs里打包的不只是应用，而是整个操作系统文件和目录，意味着应用以及它运行所需要的所有依赖都封装在了一起，所以容器有了最好的迁移性。</p>
<h3 id="UnionFS"><a href="#UnionFS" class="headerlink" title="UnionFS"></a>UnionFS</h3><p>在工作中，修改都是基于旧的rootfs，比如同事用ubuntu制作了一个rootfs并安装了java环境，用来部署我的java应用，那么我的朋友在发布他的java应用时想使用我安装过java环境的rootfs。那么我们可以增量修改，只需要去维护相对于base rootfs的增量内容，而不必每次都去制造一个fork。</p>
<p>因此引入了层的概念（layer），用户制作镜像的每一步操作都会生成一个层，也就是一个增量rootfs，这种技术使用了UnionFS（union file system,联合文件系统）。他将不同位置的目录联合挂在（union mount）道同一个目录下。</p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/IMG_20221121_011948_edit_6575732350036.jpg" alt="IMG_20221121_011948_edit_6575732350036"></p>
<p>此时在c里对abx修改，A，和B中也会生效</p>
<h4 id="AuFS"><a href="#AuFS" class="headerlink" title="AuFS"></a>AuFS</h4><p>在docker中使用的unionFS式AuFS（Another UnionFS,后更名为Alternative UnionFS，再后来叫Advance UnionFS），所以他是原生linuxUnionFS的重写和改进</p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/image-20221121013303379.png" alt="image-20221121013303379"></p>
<p>这个就有11层组成，即五个增量rootfs，run时docker会把增量联合起来统一挂载在一个点</p>
<img src="C:\Users\Mgrsc\Desktop\study\it\Cloudcompute\Container\docker\assets\文档扫描_20221121_014036350.jpg" alt="文档扫描_20221121_014036350" style="zoom: 25%;" />



<p>1.只读层</p>
<p>只读层联合挂载的方式是只读（ro+wh，readonly+whiteout）</p>
<p>2.可读写层</p>
<p>挂载方式是rw，再写入文件前该目录是空的，一旦在容器里面进行了写操作，我的修改i内容就会以增量的方式写入该层。</p>
<p>如果我们要删除一个只读层的文件AuFS就会在可读写层创建一个witeout（白障）文件，把只读层里面的文件“遮挡”起来。</p>
<p><strong>所以该层是专门用来存放我修改rootfs后产生的增量的，无论增删减改</strong>，修改完后可以用docker commit和push保存这个可读写层</p>
<p>3.Init层</p>
<p>该层是一个以-init结尾的层，是docker项目单独生成的一个内部层，专门存放&#x2F;etc&#x2F;hosts   &#x2F;etc&#x2F;resolv.conf等信息</p>
<p>这些文本本来属于只读ubuntu的一部分但是用户往往会给一些指定值（比如hostname），所以需要在可读写层修改他们，可是我们在commit时候不希望把这些消息也连同提交，所以docker把该层独立出来，在用户执行docker commit时候只会提交可读写层。</p>
<p>docker commit 激素hi在容器运行起来之后把最上层的可读写层加上原先的容器镜像的只读层，打包成一个镜像，下面这些只读层在宿主机上是共享的不会占用额外的空间。</p>
<p>由于使用了unionfs，因此在容器里对镜像rootfs所做的任何修改都会被操作系统先复制到这个可读写曾然后在修改，这就是copy-on-write写时复制</p>
<h3 id="核心原理"><a href="#核心原理" class="headerlink" title="核心原理"></a>核心原理</h3><p>所以docker项目最核心的原理就是：</p>
<ol>
<li>启用Linux Namespace配置；</li>
<li>设置指定的Cgroups参数;</li>
<li>切换进程的根目录（change root).</li>
</ol>
<p>一個正在運行的linux容器可以由：</p>
<ol>
<li>一組聯合挂在在&#x2F;var&#x2F;lib&#x2F;docker&#x2F;aufs&#x2F;mnt上的rootfs，這一部分稱爲容器鏡像（container images),是容器的靜態視圖；</li>
<li>一個由namespace+cgroup構成的隔離環境，這一部分稱爲容器運行時(container runtime),是容器的動態視圖。</li>
</ol>
<h2 id="docker的组件"><a href="#docker的组件" class="headerlink" title="docker的组件"></a>docker的组件</h2><h5 id="Docker的核心组件："><a href="#Docker的核心组件：" class="headerlink" title="Docker的核心组件："></a>Docker的核心组件：</h5><p>1.Docker客户端和服务器，也成为docker引擎：docker是一个客户端、服务器（C&#x2F;S）架构的程序</p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/IMG_20221014_003816_edit_459993809165747.jpg" alt="IMG_20221014_003816_edit_459993809165747"></p>
<p>2.docker镜像（image)：用户基于镜像来运行自己的容器。镜像也是docker生命周期中“构建”的部分。镜像是基于联合（Union）文件系统的一种层式结构，由一系列指令一步一步构建出来。</p>
<p>3.docker容器：用户只需要把自己的应用程序或者服务打包放进容器即可，容器基于镜像启动，容器可以运行一个或多个进程。镜像是docker生命周期中的构建或打包阶段，容器则是启动或执行阶段。docker容器就是一个镜像格式；一系列标准操作；一个执行环境。</p>
<p>4.Registry：Docker用Registry来保护用户构建的镜像。Registry分为公共和私有，docker公司运营的公共Registry叫做Docker Hub。</p>
<p>Docker借鉴了集装箱概念，每个容器都包含一个软件镜像，也就是容器的货物，在这些操作中容器不关心塞了什么也不关心运到何方，和集装箱一样方便替换，可以叠加，易于分发，尽量通用。</p>
<h5 id="Docker的技术组件："><a href="#Docker的技术组件：" class="headerlink" title="Docker的技术组件："></a>Docker的技术组件：</h5><p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/IMG_20221014_005101.jpg" alt="IMG_20221014_005101"></p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/IMG_20221014_005342.jpg" alt="IMG_20221014_005342"></p>
<h5 id="docker工作流程"><a href="#docker工作流程" class="headerlink" title="docker工作流程"></a>docker工作流程</h5><p>1.docker build</p>
<p>当我们写完dockerfile交给docker“编译”时使用这个命令，那么client在接收到请求后转发给docker daemon，接着docker daemon根据dockerfile创建出“可执行程序”image。</p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/v2-f16577a98471b4c4b5b1af1036882caa.jpeg" alt="v2-f16577a98471b4c4b5b1af1036882caa"></p>
<p>2.docker run</p>
<p>有了“可执行程序”image后就可以运行程序了，接下来使用命令docker run，docker daemon接收到该命令后找到具体的image，然后加载到内存开始执行，image执行起来就是所谓的container。</p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/v2-672b29e2d53d2ab044269b026c6bc473.jpeg" alt="v2-672b29e2d53d2ab044269b026c6bc473"></p>
<p>3.docker pull</p>
<p>那么docker pull是什么意思呢？</p>
<p>我们之前说过，docker中image的概念就类似于“可执行程序”，我们可以从哪里下载到别人写好的应用程序呢？很简单，那就是APP Store，即应用商店。与之类似，既然image也是一种“可执行程序”，那么有没有”Docker Image Store”呢？答案是肯定的，这就是Docker Hub，docker官方的“应用商店”，你可以在这里下载到别人编写好的image，这样你就不用自己编写dockerfile了。</p>
<p>docker registry 可以用来存放各种image，公共的可以供任何人下载image的仓库就是docker Hub。那么该怎么从Docker Hub中下载image呢，就是这里的docker pull命令了。</p>
<p>因此，这个命令的实现也很简单，那就是用户通过docker client发送命令，docker daemon接收到命令后向docker registry发送image下载请求，下载后存放在本地，这样我们就可以使用image了。</p>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/v2-dac570abcf7e1776cc266a60c4b19e5e.jpeg" alt="v2-dac570abcf7e1776cc266a60c4b19e5e"></p>
<h5 id="docker的底层实现"><a href="#docker的底层实现" class="headerlink" title="docker的底层实现"></a>docker的底层实现</h5><p>docker基于Linux内核提供这样几项功能实现的：</p>
<p>NameSpace<br>我们知道Linux中的PID、IPC、网络等资源是全局的，而NameSpace机制是一种资源隔离方案，在该机制下这些资源就不再是全局的了，而是属于某个特定的NameSpace，各个NameSpace下的资源互不干扰，这就使得每个NameSpace看上去就像一个独立的操作系统一样，但是只有NameSpace是不够。<br>Control groups<br>虽然有了NameSpace技术可以实现资源隔离，但进程还是可以不受控的访问系统资源，比如CPU、内存、磁盘、网络等，为了控制容器中进程对资源的访问，Docker采用control groups技术(也就是cgroup)，有了cgroup就可以控制容器中进程对系统资源的消耗了，比如你可以限制某个容器使用内存的上限、可以在哪些CPU上运行等等。<br>有了这两项技术，容器看起来就真的像是独立的操作系统了。</p>
<h2 id="Docker的使用"><a href="#Docker的使用" class="headerlink" title="Docker的使用"></a>Docker的使用</h2><h3 id="Docker容器使用"><a href="#Docker容器使用" class="headerlink" title="Docker容器使用"></a>Docker容器使用</h3><h5 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a>docker run</h5><p>Docker 允许你在容器内运行应用程序， 使用 docker run 命令来在容器内运行一个应用程序。</p>
<ul>
<li><p><strong>docker:</strong> Docker 的二进制执行文件。</p>
</li>
<li><p><strong>run:</strong> 与前面的 docker 组合来运行一个容器。</p>
</li>
<li><p><strong>ubuntu:15.10</strong> 指定要运行的镜像，Docker 首先从本地主机上查找镜像是否存在，如果不存在，Docker 就会从镜像仓库 Docker Hub 下载公共镜像。</p>
</li>
<li><p><strong>&#x2F;bin&#x2F;echo “Hello world”:</strong> 在启动的容器里执行的命令</p>
</li>
<li><p>–name 命名</p>
</li>
<li><p>–restart 让dockers自动重启因某种错误导致的容器停止运行</p>
</li>
<li><p>–add-host可以添加hosts记录</p>
</li>
<li><p>–hostname可以设置主机名</p>
</li>
<li><p>-v 将宿主机的目录作为卷，挂载到容器里，卷式在一个或多个容器内被共享的目录，可以绕过分层的联合文件系统，为docker提供持久数据或者共享数据，对卷的修改会直接生效，镜像提交时候，卷不包括在内。在最后加上：后跟权限可以指定容器内的目录的读写</p>
</li>
<li><p>–cpu-period&#x3D;  –cpu-quota&#x3D; 这两个参数需要结合使用，限制进程长度为period&#x3D;的一段时间内被分配到总量为quota&#x3D;的cpu时间，该限制可以在&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;cpu&#x2F;docker&#x2F;容器id找到</p>
</li>
<li><p>–net&#x3D; 指定了容器在哪个网络中运行(–net&#x3D;host不使用network namespace即不创建网络，使用宿主机网络)，network namespace加入。</p>
</li>
<li><p>–env 指定容器的环境变量，在容器内使用代理需要设置env为<code>http_proxy=&quot;socks5://宿主机的地址:10808&quot;</code></p>
</li>
</ul>
<p>以上命令完整的意思可以解释为：Docker 以 ubuntu15.10 镜像创建一个新容器，然后在容器里执行 bin&#x2F;echo “Hello world”，然后输出结果。</p>
<ul>
<li><strong>-t:</strong> 在新容器内指定一个伪终端或终端。</li>
<li><strong>-i:</strong> 允许你对容器内的标准输入 (STDIN) 进行交互。</li>
</ul>
<p>注意第二行 **root@0123ce188bd8:&#x2F;#**，此时我们已进入一个 ubuntu15.10 系统的容器</p>
<p>我们可以通过运行 exit 命令或者使用 CTRL+D 来退出容器。</p>
<p>-d 创建一个运行在后台的容器</p>
<p>输出详情介绍：</p>
<p><strong>CONTAINER ID:</strong> 容器 ID。</p>
<p><strong>IMAGE:</strong> 使用的镜像。</p>
<p><strong>COMMAND:</strong> 启动容器时运行的命令。</p>
<p><strong>CREATED:</strong> 容器的创建时间。</p>
<p><strong>STATUS:</strong> 容器状态。</p>
<p>状态有7种：</p>
<ul>
<li>created（已创建）</li>
<li>restarting（重启中）</li>
<li>running 或 Up（运行中）</li>
<li>removing（迁移中）</li>
<li>paused（暂停）</li>
<li>exited（停止）</li>
<li>dead（死亡）</li>
</ul>
<p><strong>PORTS:</strong> 容器的端口信息和使用的连接类型（tcp\udp）。</p>
<p><strong>NAMES:</strong> 自动分配的容器名称。</p>
<h5 id="docker-logs"><a href="#docker-logs" class="headerlink" title="docker logs"></a>docker logs</h5><p>在宿主主机内使用 <strong>docker logs</strong> 命令，查看容器内的标准输出</p>
<h5 id="docker-stop-amp-amp-docker-skill"><a href="#docker-stop-amp-amp-docker-skill" class="headerlink" title="docker stop &amp;&amp; docker skill"></a>docker stop &amp;&amp; docker skill</h5><p>docker stop 发送SIGTERM信号，缓慢停止</p>
<p>docker kill 发送SIGKILL信号，快速杀死容器</p>
<h5 id="docker-inspect"><a href="#docker-inspect" class="headerlink" title="docker inspect"></a>docker inspect</h5><p>获取容器&#x2F;镜像的元数据。</p>
<ul>
<li>**-f :**指定返回值的模板文件。</li>
<li>**-s :**显示总的文件大小。</li>
<li>**–type :**为指定类型返回JSON。</li>
<li>–format：支持go语言</li>
</ul>
<h5 id="docker-ps"><a href="#docker-ps" class="headerlink" title="docker ps"></a>docker ps</h5><p>查看容器</p>
<ul>
<li>**-a :**显示所有的容器，包括未运行的。</li>
<li>**-f :**根据条件过滤显示的内容。</li>
<li>**–format :**指定返回值的模板文件。</li>
<li>**-l :**显示最近创建的容器。</li>
<li>**-n :**列出最近创建的n个容器。</li>
<li>**–no-trunc :**不截断输出。</li>
<li>**-q :**静默模式，只显示容器编号。</li>
<li>**-s :**显示总的文件大小。</li>
</ul>
<h5 id="docker-attach"><a href="#docker-attach" class="headerlink" title="docker attach"></a>docker attach</h5><p>附着到容器上。</p>
<p>要attach上去的容器必须正在运行，可以同时连接上同一个container来共享屏幕（与screen命令的attach类似）。</p>
<p>官方文档中说attach后可以通过CTRL-C来detach，但实际上经过我的测试，如果container当前在运行bash，CTRL-C自然是当前行的输入，没有退出；如果container当前正在前台运行进程，如输出nginx的access.log日志，CTRL-C不仅会导致退出容器，而且还stop了。这不是我们想要的，detach的意思按理应该是脱离容器终端，但容器依然运行。好在attach是可以带上–sig-proxy&#x3D;false来确保CTRL-D或CTRL-C不会关闭容器。</p>
<ul>
<li>可以使用 <code>docker exec -it 容器id /bin/bash</code> 进入容器并开启一个新的bash终端。 <strong>退出容器终端时，不会导致容器的停止。</strong></li>
<li>使用 <code>docker attach 容器id</code> 进入正在执行容器，不会启动新的终端， <strong>退出容器时，会导致容器的停止。</strong></li>
</ul>
<h5 id="docker-logs-1"><a href="#docker-logs-1" class="headerlink" title="docker logs"></a>docker logs</h5><p>获取容器日志</p>
<ul>
<li><strong>-f :</strong> 跟踪日志输出</li>
<li>**–since :**显示某个开始时间的所有日志</li>
<li><strong>-t :</strong> 显示时间戳</li>
<li>**–tail :**仅列出最新N条容器日志</li>
</ul>
<h5 id="docker-top"><a href="#docker-top" class="headerlink" title="docker top"></a>docker top</h5><p>查看容器中运行的进程信息，支持 ps 命令参数。</p>
<h5 id="docker-stats"><a href="#docker-stats" class="headerlink" title="docker stats"></a>docker stats</h5><p>显示容器资源的使用情况，包括：CPU、内存、网络 I&#x2F;O 等。</p>
<ul>
<li>**–all , -a :**显示所有的容器，包括未运行的。</li>
<li>**–format :**指定返回值的模板文件。</li>
<li>**–no-stream :**展示当前状态就直接退出了，不再实时更新。</li>
<li>**–no-trunc :**不截断输出。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">runoob@runoob:~$  docker stats</span><br><span class="line">CONTAINER ID        NAME                                    CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">b95a83497c91        awesome_brattain                        0.28%               5.629MiB / 1.952GiB   0.28%               916B / 0B           147kB / 0B          9</span><br><span class="line">67b2525d8ad1        foobar                                  0.00%               1.727MiB / 1.952GiB   0.09%               2.48kB / 0B         4.11MB / 0B         2</span><br><span class="line">e5c383697914        test-1951.1.kay7x1lh1twk9c0oig50sd5tr   0.00%               196KiB / 1.952GiB     0.01%               71.2kB / 0B         770kB / 0B          1</span><br><span class="line">4bda148efbc0        random.1.vnc8on831idyr42slu578u3cr      0.00%               1.672MiB / 1.952GiB   0.08%               110kB / 0B          578kB / 0B          2</span><br></pre></td></tr></table></figure>

<p>输出详情介绍：</p>
<p><strong>CONTAINER ID 与 NAME:</strong> 容器 ID 与名称。</p>
<p><strong>CPU % 与 MEM %:</strong> 容器使用的 CPU 和内存的百分比。</p>
<p><strong>MEM USAGE &#x2F; LIMIT:</strong> 容器正在使用的总内存，以及允许使用的内存总量。</p>
<p><strong>NET I&#x2F;O:</strong> 容器通过其网络接口发送和接收的数据量。</p>
<p><strong>BLOCK I&#x2F;O:</strong> 容器从主机上的块设备读取和写入的数据量。</p>
<p><strong>PIDs:</strong> 容器创建的进程或线程数。</p>
<h5 id="docker-start-x2F-stop-x2F-restart"><a href="#docker-start-x2F-stop-x2F-restart" class="headerlink" title="docker start&#x2F;stop&#x2F;restart"></a>docker start&#x2F;stop&#x2F;restart</h5><p><strong>docker start</strong> :启动一个或多个已经被停止的容器</p>
<p><strong>docker stop</strong> :停止一个运行中的容器</p>
<p><strong>docker restart</strong> :重启容器</p>
<h5 id="docker-exec"><a href="#docker-exec" class="headerlink" title="docker exec"></a>docker exec</h5><p>在运行的容器中执行命令</p>
<ul>
<li>**-d :**分离模式: 在后台运行</li>
<li>**-i :**即使没有附加也保持STDIN 打开</li>
<li>**-t :**分配一个伪终端</li>
</ul>
<p>一个进程的每种linux namespace都在他对应的&#x2F;proc&#x2F;进程号&#x2F;ns下雨哦一个对应的虚拟文件，并且连接到一个真实的namespace文件上，这样加入进程的某个已有namespce中即可进入</p>
<p>系统通过open（）系统调用打开指定的namespace文件，并且把该文件的描述符fd交给setns（）使用，在setns（）执行后，当前进程就加入了这个文件对应的了inuxnamespace中了。</p>
<p>可以使用 <code>docker exec -it 容器id /bin/bash</code> 进入容器并开启一个新的bash终端。 <strong>退出容器终端时，不会导致容器的停止。</strong></p>
<p>使用 <code>docker attach 容器id</code> 进入正在执行容器，不会启动新的终端， <strong>退出容器时，会导致容器的停止。</strong></p>
<h5 id="docker-rm"><a href="#docker-rm" class="headerlink" title="docker rm"></a>docker rm</h5><ul>
<li>**-f :**通过 SIGKILL 信号强制删除一个运行中的容器。</li>
<li>**-l :**移除容器间的网络连接，而非容器本身。</li>
<li>**-v :**删除与容器关联的卷。</li>
</ul>
<h3 id="Docker镜像"><a href="#Docker镜像" class="headerlink" title="Docker镜像"></a>Docker镜像</h3><h5 id="docker-images"><a href="#docker-images" class="headerlink" title="docker images"></a>docker images</h5><ul>
<li><p>**-a :**列出本地所有的镜像（含中间映像层，默认情况下，过滤掉中间映像层）；</p>
</li>
<li><p>**–digests :**显示镜像的摘要信息；</p>
</li>
<li><p>**-f :**显示满足条件的镜像；</p>
</li>
<li><p>**–format :**指定返回值的模板文件；</p>
</li>
<li><p>**–no-trunc :**显示完整的镜像信息；</p>
</li>
<li><p>**-q :**只显示镜像ID。</p>
</li>
</ul>
<h5 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a>docker pull</h5><ul>
<li><p>**-a :**拉取所有 tagged 镜像</p>
</li>
<li><p>**–disable-content-trust :**忽略镜像的校验,默认开启</p>
</li>
</ul>
<h5 id="docker-search"><a href="#docker-search" class="headerlink" title="docker search"></a>docker search</h5><p>从Docker Hub查找镜像</p>
<ul>
<li>**–automated :**只列出 automated build类型的镜像；</li>
<li>**–no-trunc :**显示完整的镜像描述；</li>
<li>**-f &lt;过滤条件&gt;:**列出收藏数不小于指定值的镜像。</li>
</ul>
<h5 id="docker-commit"><a href="#docker-commit" class="headerlink" title="docker commit"></a>docker commit</h5><p>从容器创建一个新的镜像。</p>
<ul>
<li><p>**-a :**提交的镜像作者；</p>
</li>
<li><p>**-c :**使用Dockerfile指令来创建镜像；</p>
</li>
<li><p>**-m :**提交时的说明文字；</p>
</li>
<li><p>**-p :**在commit时，将容器暂停。</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">runoob@runoob:~$ docker commit -a &quot;runoob.com&quot; -m &quot;my apache&quot; a404c6c174a2  mymysql:v1 </span><br><span class="line">sha256:37af1236adef1544e8886be23010b66577647a40bc02c0885a6600b33ee28057</span><br><span class="line">runoob@runoob:~$ docker images mymysql:v1</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mymysql             v1                  37af1236adef        15 seconds ago      329 MB</span><br></pre></td></tr></table></figure>












<h5 id="docker-rmi"><a href="#docker-rmi" class="headerlink" title="docker rmi"></a>docker rmi</h5><p>删除本地一个或多个镜像。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-f :强制删除；</span><br><span class="line"></span><br><span class="line">--no-prune :不移除该镜像的过程镜像，默认移除；</span><br></pre></td></tr></table></figure>





<h4 id="dockerfire"><a href="#dockerfire" class="headerlink" title="dockerfire"></a>dockerfire</h4><p>在dockerfile中每个原语执行后，都会生成一个对应的镜像层</p>
<h5 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a><strong>FROM</strong></h5><p>定制的镜像都是基于 FROM 的镜像，这里的 nginx 就是定制需要的基础镜像。后续的操作都是基于 nginx。</p>
<h5 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a><strong>RUN</strong></h5><p>指定镜像被构建时要运行的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">shell 格式：</span><br><span class="line"></span><br><span class="line">RUN &lt;命令行命令&gt;</span><br><span class="line"># &lt;命令行命令&gt; 等同于，在终端操作的 shell 命令。</span><br><span class="line">exec 格式：</span><br><span class="line"></span><br><span class="line">以下通过数组传递是为了避免命令自动加入/binsh -c带来的错误**</span><br><span class="line">RUN [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;]</span><br><span class="line"># 例如：</span><br><span class="line"># RUN [&quot;./test.php&quot;, &quot;dev&quot;, &quot;offline&quot;] 等价于 RUN ./test.php dev offline</span><br></pre></td></tr></table></figure>

<h5 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h5><p>容器被启动时要运行的，推荐使用数组方式设置：CMD[“&#x2F;bin&#x2F;true”]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CMD 在docker run 时运行。</span><br><span class="line">RUN 是在 docker build。</span><br><span class="line">如果 Dockerfile 中如果存在多个 CMD 指令，仅最后一个生效。</span><br></pre></td></tr></table></figure>

<p>docker run 可以覆盖CMD指令</p>
<h5 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h5><p>类似于 CMD 指令，但其不会被 docker run 的命令行参数指定的指令所覆盖，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序。</p>
<p><strong>运行 docker run 时使用了 –entrypoint 选项，将覆盖 ENTRYPOINT 指令指定的程序。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#优点：在执行 docker run 的时候可以指定 ENTRYPOINT 运行所需的参数。</span><br><span class="line"></span><br><span class="line">#注意：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生#效。</span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line">RUN yum -y install wget \</span><br><span class="line">  &amp;&amp; **wget** -O redis.tar.gz &quot;http://download.redis.io/releases/redis-5.0.3.tar.gz&quot; \</span><br><span class="line">  &amp;&amp; tar -xvf redis.tar.gz</span><br></pre></td></tr></table></figure>

<p>如上，以 <strong>&amp;&amp;</strong> 符号连接命令，这样执行后，只会创建 1 层镜像。</p>
<h5 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h5><p>指定工作目录。用 WORKDIR 指定的工作目录，会在构建镜像的每一层中都存在。（WORKDIR 指定的工作目录，必须是提前创建好的）。</p>
<p>docker build 构建镜像过程中的，每一个 RUN 命令都是新建的一层。只有通过 WORKDIR 创建的目录才会一直存在。</p>
<p>可以通过-w标制在运行时覆盖工作目录</p>
<h5 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h5><p>设置环境变量，定义了环境变量，那么在后续的RUN指令中，就可以使用这个环境变量（如同在命令前指定了前缀。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ENV RVM_PATH /home/rvm</span><br><span class="line">RUN gem install unicorn == RVM_PATH=/home/rvm/ gem install unicorn</span><br></pre></td></tr></table></figure>

<p>也可使用docker run命令-e标制来传递环境变量。但只在运行时有效。</p>
<h5 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h5><p>用于指定执行后续命令的用户和用户组，这边只是切换后续命令执行的用户（用户和用户组必须提前已经存在）。</p>
<p>docker run -u 可以覆盖</p>
<h5 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h5><p>基于镜像创建的容器添加卷，一个卷时可以存在于一个或者多个容器内的特定目录，这个目录可以绕过联合文件系统。可以让我们将数据、数据库、或者其他内容添加到镜像中而不是将他们提交到镜像中，并且允许我们在多个容器见共享这些内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VOLUME [&quot;/opt/project&quot;]#会基于镜像创建的任何容器创建一个名为/opt/project 的挂载点</span><br></pre></td></tr></table></figure>

<p>作用：</p>
<ul>
<li>避免重要的数据，因容器重启而丢失，这是非常致命的。</li>
<li>避免容器不断变大。</li>
<li>卷可以在容器间共享和重用</li>
<li>对卷的修改时立即生效的</li>
<li>对卷的修改不会对更新镜像产生影响</li>
<li>卷会一直存在直到没有任何容器使用它</li>
</ul>
<p>在启动容器 docker run 的时候，我们可以通过 -v 参数修改挂载点。将宿主机的目录作为卷，挂载到容器里。</p>
<h5 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h5><p>ADD 指令和 COPY 的使用格类似（同样需求下，官方推荐使用 COPY），将构建目录下的文件复制到镜像中的指定位置，指向源文件的位置参数可以是一个url，或者构建上下文或者环境中文件名或者目录，也可以时压缩文件，压缩文件会自动解压。功能也类似，不同之处如下：</p>
<ul>
<li>ADD 的优点：在执行 &lt;源文件&gt; 为 tar 压缩文件的话，压缩格式为 gzip, bzip2 以及 xz 的情况下，会自动复制并解压到 &lt;目标路径&gt;。</li>
<li>ADD 的缺点：在不解压的前提下，无法复制 tar 压缩文件。会令镜像构建缓存失效，从而可能会令镜像构建变得比较缓慢。具体是否使用，可以根据是否需要自动解压来决定。</li>
</ul>
<h5 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h5><p>复制指令，从上下文目录中复制文件或者目录到容器里指定路径。</p>
<p>同ADD类似但是不会去做文件提取和解压。</p>
<h5 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h5><p>指令为Docker镜像添加元数据。元数据以键值对的形式展开。可以通过docker inspect查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LABEL &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span><br></pre></td></tr></table></figure>

<h5 id="STOPSIGNAL"><a href="#STOPSIGNAL" class="headerlink" title="STOPSIGNAL"></a>STOPSIGNAL</h5><p>用来设置停止容器时发送什么系统调用信号给容器。这个信号必须时内核系统调用表中合法的数，如9或者SIGNAME格式中的信号名称，如SIGKILL</p>
<h5 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h5><p>构建参数，与 ENV 作用一致。不过作用域不一样。ARG 设置的环境变量仅对 Dockerfile 内有效，也就是说只有 docker build 的过程中有效，构建好的镜像内不存在此环境变量。</p>
<p>构建命令 docker build 中可以用 –build-arg &lt;参数名&gt;&#x3D;&lt;值&gt; 来覆盖。</p>
<h5 id="ONBUILD"><a href="#ONBUILD" class="headerlink" title="ONBUILD"></a>ONBUILD</h5><p>用于延迟构建命令的执行。简单的说，就是 Dockerfile 里用 ONBUILD 指定的命令，在本次构建镜像的过程中不会执行（假设镜像为 test-build）。当有新的 Dockerfile 使用了之前构建的镜像 FROM test-build ，这时执行新镜像的 Dockerfile 构建时候，会执行 test-build 的 Dockerfile 里的 ONBUILD 指定的命令。</p>
<h5 id="docker-build"><a href="#docker-build" class="headerlink" title="docker build"></a>docker build</h5><p>于使用 Dockerfile 创建镜像。</p>
<ul>
<li>**–build-arg&#x3D;[] :**设置镜像创建时的变量；</li>
<li>**–cpu-shares :**设置 cpu 使用权重；</li>
<li>**–cpu-period :**限制 CPU CFS周期；</li>
<li>**–cpu-quota :**限制 CPU CFS配额；</li>
<li>**–cpuset-cpus :**指定使用的CPU id；</li>
<li>**–cpuset-mems :**指定使用的内存 id；</li>
<li>**–disable-content-trust :**忽略校验，默认开启；</li>
<li>**-f :**指定要使用的Dockerfile路径；</li>
<li>**–force-rm :**设置镜像过程中删除中间容器；</li>
<li>**–isolation :**使用容器隔离技术；</li>
<li>**–label&#x3D;[] :**设置镜像使用的元数据；</li>
<li>**-m :**设置内存最大值；</li>
<li>**–memory-swap :**设置Swap的最大值为内存+swap，”-1”表示不限swap；</li>
<li>**–no-cache :**创建镜像的过程不使用缓存；</li>
<li>**–pull :**尝试去更新镜像的新版本；</li>
<li>**–quiet, -q :**安静模式，成功后只输出镜像 ID；</li>
<li>**–rm :**设置镜像成功后删除中间容器；</li>
<li>**–shm-size :**设置&#x2F;dev&#x2F;shm的大小，默认值是64M；</li>
<li>**–ulimit :**Ulimit配置。</li>
<li>**–squash :**将 Dockerfile 中所有的操作压缩为一层。</li>
<li><strong>–tag, -t:</strong> 镜像的名字及标签，通常 name:tag 或者 name 格式；可以在一次构建中为一个镜像设置多个标签。</li>
<li><strong>–network:</strong> 默认 default。在构建期间设置RUN指令的网络模式</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t nginx:v3 .</span><br></pre></td></tr></table></figure>

<p>最后一个点是上下文路径，是指 docker 在构建镜像，有时候想要使用到本机的文件（比如复制），docker build 命令得知这个路径后，会将路径下的所有内容打包。</p>
<p><strong>解析</strong>：由于 docker 的运行模式是 C&#x2F;S。我们本机是 C，docker 引擎是 S。实际的构建过程是在 docker 引擎下完成的，所以这个时候无法用到我们本机的文件。这就需要把我们本机的指定目录下的文件一起打包提供给 docker 引擎使用。</p>
<p>如果未说明最后一个参数，那么默认上下文路径就是 Dockerfile 所在的位置。</p>
<p><strong>注意</strong>：上下文路径下不要放无用的文件，因为会一起打包发送给 docker 引擎，如果文件过多会造成过程缓慢。</p>
<h5 id="docker-history"><a href="#docker-history" class="headerlink" title="docker history"></a>docker history</h5><p>查看指定镜像的创建历史。</p>
<ul>
<li><p>**-H :**以可读的格式打印镜像大小和日期，默认为true；</p>
</li>
<li><p>**–no-trunc :**显示完整的提交记录；</p>
</li>
<li><p>**-q :**仅列出提交记录ID。</p>
</li>
</ul>
<h5 id="dockers-port"><a href="#dockers-port" class="headerlink" title="dockers port"></a>dockers port</h5><p>列出指定的容器的端口映射，或者查找将PRIVATE_PORT NAT到面向公众的端口。</p>
<p>-p映射到特定端口</p>
<h5 id="docker-pull-1"><a href="#docker-pull-1" class="headerlink" title="docker pull"></a>docker pull</h5><p>从镜像仓库中拉取或者更新指定镜像</p>
<ul>
<li><p>**-a :**拉取所有 tagged 镜像</p>
</li>
<li><p>**–disable-content-trust :**忽略镜像的校验,默认开启</p>
</li>
</ul>
<h5 id="docker-push"><a href="#docker-push" class="headerlink" title="docker push"></a>docker push</h5><p>将本地的镜像上传到镜像仓库,要先登陆到镜像仓库</p>
<ul>
<li>**–disable-content-trust :**忽略镜像的校验,默认开启</li>
</ul>
<p>push到自己仓库时tag的username需要是自己</p>
<p><strong>perforin</strong>&#x2F;test:12121</p>
<h5 id="docker-tag"><a href="#docker-tag" class="headerlink" title="docker tag"></a>docker tag</h5><p>标记本地镜像，将其归入某一仓库。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">将镜像ubuntu:15.10标记为 runoob/ubuntu:v3 镜像。</span><br><span class="line"></span><br><span class="line">root@runoob:~# docker tag ubuntu:15.10 runoob/ubuntu:v3</span><br><span class="line">root@runoob:~# docker images   runoob/ubuntu:v3</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">runoob/ubuntu       v3                  4e3b13c8a266        3 months ago        136.3 MB</span><br></pre></td></tr></table></figure>







<h3 id="Docker容器连接"><a href="#Docker容器连接" class="headerlink" title="Docker容器连接"></a>Docker容器连接</h3><h4 id="网络端口映射"><a href="#网络端口映射" class="headerlink" title="网络端口映射"></a>网络端口映射</h4><p><strong>-P :<strong>是容器内部端口</strong>随机</strong>映射到主机的端口。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">runoob@runoob:~$ docker run -d -P training/webapp python app.py</span><br><span class="line">fce072cc88cee71b1cdceb57c2821d054a4a59f67da6b416fceb5593f059fc6d</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker ps</span><br><span class="line">CONTAINER ID    IMAGE               COMMAND            ...           PORTS                     NAMES</span><br><span class="line">fce072cc88ce    training/webapp     &quot;python app.py&quot;    ...     0.0.0.0:32768-&gt;5000/tcp   grave_hopper</span><br></pre></td></tr></table></figure>

<p><strong>-p :</strong> 是容器内部端口绑定到<strong>指定</strong>的主机端口。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">runoob@runoob:~$ docker run -d -p 5000:5000 training/webapp python app.py</span><br><span class="line">33e4523d30aaf0258915c368e66e03b49535de0ef20317d3f639d40222ba6bc0</span><br><span class="line"></span><br><span class="line">runoob@runoob:~$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND           ...           PORTS                     NAMES</span><br><span class="line">33e4523d30aa        training/webapp     &quot;python app.py&quot;   ...   0.0.0.0:5000-&gt;5000/tcp    berserk_bartik</span><br><span class="line">fce072cc88ce        training/webapp     &quot;python app.py&quot;   ...   0.0.0.0:32768-&gt;5000/tcp   grave_hopper</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们可以指定容器绑定的网络地址，比如绑定 127.0.0.1。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">runoob@runoob:~$ docker run -d -p 127.0.0.1:5001:5000 training/webapp python app.py</span><br><span class="line">95c6ceef88ca3e71eaf303c2833fd6701d8d1b2572b5613b5a932dfdfe8a857c</span><br><span class="line">runoob@runoob:~$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND           ...     PORTS                                NAMES</span><br><span class="line">95c6ceef88ca        training/webapp     &quot;python app.py&quot;   ...  5000/tcp, 127.0.0.1:5001-&gt;5000/tcp   adoring_stonebraker</span><br><span class="line">33e4523d30aa        training/webapp     &quot;python app.py&quot;   ...  0.0.0.0:5000-&gt;5000/tcp               berserk_bartik</span><br><span class="line">fce072cc88ce        training/webapp     &quot;python app.py&quot;   ...    0.0.0.0:32768-&gt;5000/tcp              grave_hopper</span><br></pre></td></tr></table></figure>

<p>上面的例子中，默认都是绑定 tcp 端口，如果要绑定 UDP 端口，可以在端口后面加上 <strong>&#x2F;udp</strong>。</p>
<p><strong>docker port</strong> 命令可以让我们快捷地查看端口的绑定情况。</p>
<h4 id="Docker-容器互联"><a href="#Docker-容器互联" class="headerlink" title="Docker 容器互联"></a>Docker 容器互联</h4><p>docker 有一个连接系统允许将多个容器连接在一起，共享连接信息。</p>
<p>docker 连接会创建一个父子关系，其中父容器可以看到子容器的信息。</p>
<h5 id="docekr-–link"><a href="#docekr-–link" class="headerlink" title="docekr –link"></a>docekr –link</h5><p>可以一次性指定多个</p>
<p>docker在父容器的这些地方写了连接信息</p>
<ul>
<li>&#x2F;etc&#x2F;hosts</li>
<li>包含连接信息的环境变量中（可以在容器内用env查看）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 1234 \</span><br><span class="line">--name app \</span><br><span class="line">--link test1:ab \  #连接test1容器并为该服务增加ab别名</span><br><span class="line">-it \</span><br><span class="line">-v $PWD/app:/opt/app \</span><br><span class="line">ubuntu \</span><br><span class="line">/bin/bash</span><br></pre></td></tr></table></figure>

<p>把容器连接在一起可以让客户容器直接访问任一服务容器的公开端口，更重要的是只有–link标制连接到这个容器的容器才可以连接到这个端口，容器的端口不需要对本地宿主机公开。</p>
<p>启动docker守护进程时候加上–icc&#x3D;false标制，可以关闭所有没有连接的容器间的通讯。</p>
<h4 id="docker-network"><a href="#docker-network" class="headerlink" title="docker network"></a>docker network</h4><p>docker0是一个虚拟的以太网桥，用于连接容器合本地宿主机网络，docker每创建一组互联的网络接口，这组接口就像管道的两端，这组接口其中一端作为容器eth0接口，而另一端统一命名为类似vethec6a这种名字，通过把每个veth*接口绑定到docker0网桥，docker就创建了一个虚拟子网，这个子网由宿主机合所有的docker容器共享。</p>
<h5 id="docker-network-create"><a href="#docker-network-create" class="headerlink" title="docker  network create"></a>docker  network create</h5><p>-d：参数指定 Docker 网络类型，有 bridge、overlay。</p>
<p>其中 overlay 网络类型用于 Swarm mode，在本小节中你可以忽略它。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d bridge test-net</span><br></pre></td></tr></table></figure>

<h5 id="docker-connect-网络-容器"><a href="#docker-connect-网络-容器" class="headerlink" title="docker connect  网络 容器"></a>docker connect  网络 容器</h5><p>将容器添加到已有的网络</p>
<h5 id="docker-disconnect-网络-容器"><a href="#docker-disconnect-网络-容器" class="headerlink" title="docker disconnect 网络 容器"></a>docker disconnect 网络 容器</h5><p>将容器移除网络</p>
<p><strong>全局dns</strong></p>
<p>我们可以在宿主机的 &#x2F;etc&#x2F;docker&#x2F;daemon.json 文件中增加以下内容来设置全部容器的 DNS：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;dns&quot; : [</span><br><span class="line">    &quot;114.114.114.114&quot;,</span><br><span class="line">    &quot;8.8.8.8&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>手动指定容器的配置</strong></p>
<p>如果只想在指定的容器设置 DNS，则可以使用以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm -h host_ubuntu  --dns=114.114.114.114 --dns-search=test.com ubuntu</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<p><strong>–rm</strong>：容器退出时自动清理容器内部的文件系统。</p>
<p><strong>-h HOSTNAME 或者 –hostname&#x3D;HOSTNAME</strong>： 设定容器的主机名，它会被写到容器内的 &#x2F;etc&#x2F;hostname 和 &#x2F;etc&#x2F;hosts。</p>
<p><strong>–dns&#x3D;IP_ADDRESS</strong>： 添加 DNS 服务器到容器的 &#x2F;etc&#x2F;resolv.conf 中，让容器用这个服务器来解析所有不在 &#x2F;etc&#x2F;hosts 中的主机名。</p>
<p><strong>–dns-search&#x3D;DOMAIN</strong>： 设定容器的搜索域，当设定搜索域为 .example.com 时，在搜索一个名为 host 的主机时，DNS 不仅搜索 host，还会搜索 host.example.com。</p>
<h3 id="Docker-编排"><a href="#Docker-编排" class="headerlink" title="Docker 编排"></a>Docker 编排</h3><h4 id="DockerCompose"><a href="#DockerCompose" class="headerlink" title="DockerCompose"></a>DockerCompose</h4><p>用一个YAML文件定义一组要启动的容器，以及运行容器时的属性，dockercompose称这些容器为“服务”</p>
<p>容器通过某些方法并指定一些运行时的属性来和其他容器产生交互。</p>
<p>在测试目录中，执行以下命令来启动应用程序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up</span><br></pre></td></tr></table></figure>

<p>如果你想在后台执行该服务可以加上 -d 参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p><strong>yml 配置指令参考</strong><br>version<br>指定本 yml 依从的 compose 哪个版本制定的。</p>
<p>build<br>指定为构建镜像上下文路径：</p>
<p>例如 webapp 服务，指定为从上下文路径 .&#x2F;dir&#x2F;Dockerfile 所构建的镜像：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.7&quot;</span><br><span class="line">services:</span><br><span class="line">  webapp:</span><br><span class="line">    build: ./dir</span><br></pre></td></tr></table></figure>

<p>或者，作为具有在上下文指定的路径的对象，以及可选的 Dockerfile 和 args：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.7&quot;</span><br><span class="line">services:</span><br><span class="line">  webapp:</span><br><span class="line">    build:</span><br><span class="line">      context: ./dir</span><br><span class="line">      dockerfile: Dockerfile-alternate</span><br><span class="line">      args:</span><br><span class="line">        buildno: 1</span><br><span class="line">      labels:</span><br><span class="line">        - &quot;com.example.description=Accounting webapp&quot;</span><br><span class="line">        - &quot;com.example.department=Finance&quot;</span><br><span class="line">        - &quot;com.example.label-with-empty-value&quot;</span><br><span class="line">      target: prod</span><br></pre></td></tr></table></figure>

<p>context：上下文路径。<br>dockerfile：指定构建镜像的 Dockerfile 文件名。<br>args：添加构建参数，这是只能在构建过程中访问的环境变量。<br>labels：设置构建镜像的标签。<br>target：多层构建，可以指定构建哪一层。<br>cap_add，cap_drop<br>添加或删除容器拥有的宿主机的内核功能。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cap_add:</span><br><span class="line">ALL # 开启全部权限</span><br><span class="line">cap_drop:</span><br><span class="line">SYS_PTRACE # 关闭 ptrace权限</span><br><span class="line">cgroup_parent</span><br><span class="line">为容器指定父 cgroup 组，意味着将继承该组的资源限制。</span><br><span class="line">cgroup_parent: m-executor-abcd</span><br></pre></td></tr></table></figure>

<p>command<br>覆盖容器启动的默认命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command: [&quot;bundle&quot;, &quot;exec&quot;, &quot;thin&quot;, &quot;-p&quot;, &quot;3000&quot;]</span><br></pre></td></tr></table></figure>

<p>container_name<br>指定自定义容器名称，而不是生成的默认名称。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">container_name: my-web-container</span><br></pre></td></tr></table></figure>

<p>depends_on<br>设置依赖关系。</p>
<ul>
<li>docker-compose up ：以依赖性顺序启动服务。在以下示例中，先启动 db 和 redis ，才会启动 web。</li>
<li>docker-compose up SERVICE ：自动包含 SERVICE 的依赖项。在以下示例中，docker-compose up web 还将创建并启动 db 和 redis。</li>
<li>docker-compose stop ：按依赖关系顺序停止服务。在以下示例中，web 在 db 和 redis 之前停止。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.7&quot;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line">      - redis</span><br><span class="line">  redis:</span><br><span class="line">    image: redis</span><br><span class="line">  db:</span><br><span class="line">    image: postgres</span><br></pre></td></tr></table></figure>

<p>注意：web 服务不会等待 redis db 完全启动 之后才启动。</p>
<p>deploy<br>指定与服务的部署和运行有关的配置。只在 swarm 模式下才会有用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.7&quot;</span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:alpine</span><br><span class="line">    deploy:</span><br><span class="line">      mode：replicated</span><br><span class="line">      replicas: 6</span><br><span class="line">      endpoint_mode: dnsrr</span><br><span class="line">      labels: </span><br><span class="line">        description: &quot;This redis service label&quot;</span><br><span class="line">      resources:</span><br><span class="line">        limits:</span><br><span class="line">          cpus: &#x27;0.50&#x27;</span><br><span class="line">          memory: 50M</span><br><span class="line">        reservations:</span><br><span class="line">          cpus: &#x27;0.25&#x27;</span><br><span class="line">          memory: 20M</span><br><span class="line">      restart_policy:</span><br><span class="line">        condition: on-failure</span><br><span class="line">        delay: 5s</span><br><span class="line">        max_attempts: 3</span><br><span class="line">        window: 120s</span><br></pre></td></tr></table></figure>

<p>可以选参数：</p>
<p>endpoint_mode：访问集群服务的方式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">endpoint_mode: vip </span><br><span class="line">Docker 集群服务一个对外的虚拟 ip。所有的请求都会通过这个虚拟 ip 到达集群服务内部的机器。</span><br><span class="line">endpoint_mode: dnsrr</span><br><span class="line">DNS 轮询（DNSRR）。所有的请求会自动轮询获取到集群 ip 列表中的一个 ip 地址。</span><br></pre></td></tr></table></figure>

<p>labels：在服务上设置标签。可以用容器上的 labels（跟 deploy 同级的配置） 覆盖 deploy 下的 labels。</p>
<p>mode：指定服务提供的模式。</p>
<p>replicated：复制服务，复制指定服务到集群的机器上。</p>
<p>global：全局服务，服务将部署至集群的每个节点。</p>
<p>图解：下图中黄色的方块是 replicated 模式的运行情况，灰色方块是 global 模式的运行情况。</p>
<p>replicas：mode 为 replicated 时，需要使用此参数配置具体运行的节点数量。</p>
<p>resources：配置服务器资源使用的限制，例如上例子，配置 redis 集群运行需要的 cpu 的百分比 和 内存的占用。避免占用资源过高出现异常。</p>
<p>restart_policy：配置如何在退出容器时重新启动容器。</p>
<p>condition：可选 none，on-failure 或者 any（默认值：any）。<br>delay：设置多久之后重启（默认值：0）。<br>max_attempts：尝试重新启动容器的次数，超出次数，则不再尝试（默认值：一直重试）。<br>window：设置容器重启超时时间（默认值：0）。<br>rollback_config：配置在更新失败的情况下应如何回滚服务。</p>
<p>parallelism：一次要回滚的容器数。如果设置为0，则所有容器将同时回滚。<br>delay：每个容器组回滚之间等待的时间（默认为0s）。<br>failure_action：如果回滚失败，该怎么办。其中一个 continue 或者 pause（默认pause）。<br>monitor：每个容器更新后，持续观察是否失败了的时间 (ns|us|ms|s|m|h)（默认为0s）。<br>max_failure_ratio：在回滚期间可以容忍的故障率（默认为0）。<br>order：回滚期间的操作顺序。其中一个 stop-first（串行回滚），或者 start-first（并行回滚）（默认 stop-first ）。<br>update_config：配置应如何更新服务，对于配置滚动更新很有用。</p>
<p>parallelism：一次更新的容器数。<br>delay：在更新一组容器之间等待的时间。<br>failure_action：如果更新失败，该怎么办。其中一个 continue，rollback 或者pause （默认：pause）。<br>monitor：每个容器更新后，持续观察是否失败了的时间 (ns|us|ms|s|m|h)（默认为0s）。<br>max_failure_ratio：在更新过程中可以容忍的故障率。<br>order：回滚期间的操作顺序。其中一个 stop-first（串行回滚），或者 start-first（并行回滚）（默认stop-first）。<br>注：仅支持 V3.4 及更高版本。</p>
<p>devices<br>指定设备映射列表。</p>
<ul>
<li><pre><code>devices:

  - &quot;/dev/ttyUSB0:/dev/ttyUSB0&quot;
    dns
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  自定义 DNS 服务器，可以是单个值或列表的多个值。</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  dns: 8.8.8.8</span><br><span class="line">  </span><br><span class="line">  dns:</span><br><span class="line">  </span><br><span class="line">    - 8.8.8.8</span><br><span class="line">    - 9.9.9.9</span><br></pre></td></tr></table></figure>

dns_search
自定义 DNS 搜索域。可以是单个值或列表。
</code></pre>
</li>
<li><p>&#96;&#96;&#96;<br>dns_search: example.com</p>
<p>dns_search:</p>
<ul>
<li>dc1.example.com</li>
<li>dc2.example.com<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">entrypoint</span><br><span class="line">覆盖容器默认的 entrypoint。</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>entrypoint: &#x2F;code&#x2F;entrypoint.sh</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">也可以是以下格式：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>entrypoint:<br>    - php<br>    - -d<br>    - zend_extension&#x3D;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;extensions&#x2F;no-debug-non-zts-20100525&#x2F;xdebug.so<br>    - -d<br>    - memory_limit&#x3D;-1<br>    - vendor&#x2F;bin&#x2F;phpunit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">env_file</span><br><span class="line">从文件添加环境变量。可以是单个值或列表的多个值。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>env_file: .env</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">也可以是列表格式：</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">    env_file:</span><br><span class="line">    </span><br><span class="line">      - ./common.env</span><br><span class="line">      - ./apps/web.env</span><br><span class="line">      - /opt/secrets.env</span><br></pre></td></tr></table></figure>

<pre><code>environment
添加环境变量。您可以使用数组或字典、任何布尔值，布尔值需要用引号引起来，以确保 YML 解析器不会将其转换为 True 或 False。
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">environment:</span><br><span class="line">  RACK_ENV: development</span><br><span class="line">  SHOW: &#x27;true&#x27;</span><br></pre></td></tr></table></figure>

<p>expose<br>暴露端口，但不映射到宿主机，只被连接的服务访问。</p>
<p>仅可以指定内部端口为参数：</p>
<ul>
<li><p>&#96;&#96;&#96;<br>expose:</p>
<ul>
<li>“3000”</li>
<li>“8000”<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  extra_hosts</span><br><span class="line">  添加主机名映射。类似 docker client --add-host。</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  extra_hosts:</span><br><span class="line">  </span><br><span class="line">   - &quot;somehost:162.242.195.82&quot;</span><br><span class="line">   - &quot;otherhost:50.31.209.229&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>以上会在此服务的内部容器中 &#x2F;etc&#x2F;hosts 创建一个具有 ip 地址和主机名的映射关系：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">162.242.195.82  somehost</span><br><span class="line">50.31.209.229   otherhost</span><br></pre></td></tr></table></figure>

<p>healthcheck<br>用于检测 docker 服务是否健康运行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">healthcheck:</span><br><span class="line">  test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;] # 设置检测程序</span><br><span class="line">  interval: 1m30s # 设置检测间隔</span><br><span class="line">  timeout: 10s # 设置检测超时时间</span><br><span class="line">  retries: 3 # 设置重试次数</span><br><span class="line">  start_period: 40s # 启动后，多少秒开始启动检测程序</span><br></pre></td></tr></table></figure>

<p>image<br>指定容器运行的镜像。以下格式都可以：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">image: redis</span><br><span class="line">image: ubuntu:14.04</span><br><span class="line">image: tutum/influxdb</span><br><span class="line">image: example-registry.com:4000/postgresql</span><br><span class="line">image: a4bc65fd # 镜像id</span><br><span class="line">logging</span><br></pre></td></tr></table></figure>

<p>服务的日志记录配置。</p>
<p>driver：指定服务容器的日志记录驱动程序，默认值为json-file。有以下三个选项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver: &quot;json-file&quot;</span><br><span class="line">driver: &quot;syslog&quot;</span><br><span class="line">driver: &quot;none&quot;</span><br></pre></td></tr></table></figure>

<p>仅在 json-file 驱动程序下，可以使用以下参数，限制日志得数量和大小。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">logging:</span><br><span class="line">  driver: json-file</span><br><span class="line">  options:</span><br><span class="line">    max-size: &quot;200k&quot; # 单个文件大小为200k</span><br><span class="line">    max-file: &quot;10&quot; # 最多10个文件</span><br></pre></td></tr></table></figure>

<p>当达到文件限制上限，会自动删除旧得文件。</p>
<p>syslog 驱动程序下，可以使用 syslog-address 指定日志接收地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">logging:</span><br><span class="line">  driver: syslog</span><br><span class="line">  options:</span><br><span class="line">    syslog-address: &quot;tcp://192.168.0.42:123&quot;</span><br><span class="line">network_mode</span><br></pre></td></tr></table></figure>

<p>设置网络模式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">network_mode: &quot;bridge&quot;</span><br><span class="line">network_mode: &quot;host&quot;</span><br><span class="line">network_mode: &quot;none&quot;</span><br><span class="line">network_mode: &quot;service:[service name]&quot;</span><br><span class="line">network_mode: &quot;container:[container name/id]&quot;</span><br><span class="line">networks</span><br></pre></td></tr></table></figure>

<p>配置容器连接的网络，引用顶级 networks 下的条目 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  some-service:</span><br><span class="line">    networks:</span><br><span class="line">      some-network:</span><br><span class="line">        aliases:</span><br><span class="line">         - alias1</span><br><span class="line">      other-network:</span><br><span class="line">        aliases:</span><br><span class="line">         - alias2</span><br><span class="line">networks:</span><br><span class="line">  some-network:</span><br><span class="line">    # Use a custom driver</span><br><span class="line">    driver: custom-driver-1</span><br><span class="line">  other-network:</span><br><span class="line">    # Use a custom driver which takes special options</span><br><span class="line">    driver: custom-driver-2</span><br></pre></td></tr></table></figure>

<p>aliases ：同一网络上的其他容器可以使用服务名称或此别名来连接到对应容器的服务。</p>
<p>restart</p>
<ul>
<li>no：是默认的重启策略，在任何情况下都不会重启容器。</li>
<li>always：容器总是重新启动。</li>
<li>on-failure：在容器非正常退出时（退出状态非0），才会重启容器。</li>
<li>unless-stopped：在容器退出时总是重启容器，但是不考虑在Docker守护进程启动时就已经停止了的容器</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">restart: &quot;no&quot;</span><br><span class="line">restart: always</span><br><span class="line">restart: on-failure</span><br><span class="line">restart: unless-stopped</span><br></pre></td></tr></table></figure>

<p>注：swarm 集群模式，请改用 restart_policy。</p>
<p>secrets<br>存储敏感数据，例如密码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.1&quot;</span><br><span class="line">services:</span><br><span class="line"></span><br><span class="line">mysql:</span><br><span class="line">  image: mysql</span><br><span class="line">  environment:</span><br><span class="line">    MYSQL_ROOT_PASSWORD_FILE: /run/secrets/my_secret</span><br><span class="line">  secrets:</span><br><span class="line">    - my_secret</span><br><span class="line"></span><br><span class="line">secrets:</span><br><span class="line">  my_secret:</span><br><span class="line">    file: ./my_secret.txt</span><br></pre></td></tr></table></figure>

<p>security_opt<br>修改容器默认的 schema 标签。</p>
<p>security-opt：</p>
<ul>
<li>label:user:USER   # 设置容器的用户标签</li>
<li>label:role:ROLE   # 设置容器的角色标签</li>
<li>label:type:TYPE   # 设置容器的安全策略标签</li>
<li>label:level:LEVEL  # 设置容器的安全等级标签<br>stop_grace_period<br>指定在容器无法处理 SIGTERM (或者任何 stop_signal 的信号)，等待多久后发送 SIGKILL 信号关闭容器。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stop_grace_period: 1s # 等待 1 秒</span><br><span class="line">stop_grace_period: 1m30s # 等待 1 分 30 秒 </span><br></pre></td></tr></table></figure>

<p>默认的等待时间是 10 秒。</p>
<p>stop_signal<br>设置停止容器的替代信号。默认情况下使用 SIGTERM 。</p>
<p>以下示例，使用 SIGUSR1 替代信号 SIGTERM 来停止容器。</p>
<p>stop_signal: SIGUSR1<br>sysctls<br>设置容器中的内核参数，可以使用数组或字典格式。</p>
<ul>
<li><p>&#96;&#96;&#96;<br>sysctls:<br>  net.core.somaxconn: 1024<br>  net.ipv4.tcp_syncookies: 0</p>
<p>sysctls:</p>
<ul>
<li>net.core.somaxconn&#x3D;1024</li>
<li>net.ipv4.tcp_syncookies&#x3D;0<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  tmpfs</span><br><span class="line">  在容器内安装一个临时文件系统。可以是单个值或列表的多个值。</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  tmpfs: /run</span><br><span class="line">  </span><br><span class="line">  tmpfs:</span><br><span class="line">  </span><br><span class="line">    - /run</span><br><span class="line">    - /tmp</span><br></pre></td></tr></table></figure></li>
</ul>
<p>ulimits<br>覆盖容器默认的 ulimit。</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ulimits:</span><br><span class="line">  nproc: 65535</span><br><span class="line">  nofile:</span><br><span class="line">    soft: 20000</span><br><span class="line">    hard: 40000</span><br></pre></td></tr></table></figure>

<p>volumes<br>将主机的数据卷或着文件挂载到容器里。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.7&quot;</span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: postgres:latest</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;/localhost/postgres.sock:/var/run/postgres/postgres.sock&quot;</span><br><span class="line">            - &quot;/localhost/data:/var/lib/postgresql/data&quot;</span><br></pre></td></tr></table></figure>







<h3 id="Docker-集群管理（Swarm"><a href="#Docker-集群管理（Swarm" class="headerlink" title="Docker 集群管理（Swarm)"></a>Docker 集群管理（Swarm)</h3><p>Docker Swarm 是 Docker 的集群管理工具。它将 Docker 主机池转变为单个虚拟 Docker 主机。 Docker Swarm 提供了标准的 Docker API，所有任何已经与 Docker 守护程序通信的工具都可以使用 Swarm 轻松地扩展到多个主机。</p>
<p>支持的工具包括但不限于以下各项：</p>
<ul>
<li>Dokku</li>
<li>Docker Compose</li>
<li>Docker Machine</li>
<li>Jenkins</li>
</ul>
<p><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/services-diagram.png" alt="img"></p>
<h3 id="Docker-API"><a href="#Docker-API" class="headerlink" title="Docker API"></a>Docker API</h3><p>Docker一共提供了三种API</p>
<ul>
<li>Registry API:提供了和存储Docker镜像的Docker Registry集成的功能</li>
<li>Docker Hub API：提供了与Docker Hub集成的功能</li>
<li>Docker Remote API：提供了与Docker守护进程进行集成的功能</li>
</ul>
<h4 id="Docker-Remote-API"><a href="#Docker-Remote-API" class="headerlink" title="Docker Remote API"></a>Docker Remote API</h4><h2 id="YAML"><a href="#YAML" class="headerlink" title="YAML"></a>YAML</h2><p>YAML 是 “YAML Ain’t a Markup Language”（YAML 不是一种标记语言）的递归缩写。在开发的这种语言时，YAML 的意思其实是：”Yet Another Markup Language”（仍是一种标记语言）。</p>
<p>YAML 的语法和其他高级语言类似，并且可以简单表达清单、散列表，标量等数据形态。它使用空白符号缩进和大量依赖外观的特色，特别适合用来表达或编辑数据结构、各种配置文件、倾印调试内容、文件大纲（例如：许多电子邮件标题格式和YAML非常接近）。</p>
<p>YAML 的配置文件后缀为 <strong>.yml</strong>，如：<strong>runoob.yml</strong> 。</p>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><ul>
<li>大小写敏感</li>
<li>使用缩进表示层级关系</li>
<li>缩进不允许使用tab，<strong>只允许空格</strong></li>
<li>缩进的空格数不重要，只要相同层级的元素左对齐即可</li>
<li>‘#’表示注释</li>
</ul>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>YAML 支持以下几种数据类型：</p>
<ul>
<li>对象：键值对的集合，又称为映射（mapping）&#x2F; 哈希（hashes） &#x2F; 字典（dictionary）</li>
<li>数组：一组按次序排列的值，又称为序列（sequence） &#x2F; 列表（list）</li>
<li>纯量（scalars）：单个的、不可再分的值</li>
</ul>
<h3 id="YAML-对象"><a href="#YAML-对象" class="headerlink" title="YAML 对象"></a>YAML 对象</h3><p>对象键值对使用冒号结构表示 <strong>key: value</strong>，冒号后面要加一个空格。</p>
<p>也可以使用 **key:{key1: value1, key2: value2, …}**。</p>
<p>还可以使用缩进表示层级关系；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">key: </span><br><span class="line">    child-key: value</span><br><span class="line">    child-key2: value2</span><br></pre></td></tr></table></figure>

<p>较为复杂的对象格式，可以使用问号加一个空格代表一个复杂的 key，配合一个冒号加一个空格代表一个 value：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?  </span><br><span class="line">    - complexkey1</span><br><span class="line">    - complexkey2</span><br><span class="line">:</span><br><span class="line">    - complexvalue1</span><br><span class="line">    - complexvalue2</span><br></pre></td></tr></table></figure>

<p>意思即对象的属性是一个数组 [complexkey1,complexkey2]，对应的值也是一个数组 [complexvalue1,complexvalue2]</p>
<h3 id="YAML-数组"><a href="#YAML-数组" class="headerlink" title="YAML 数组"></a>YAML 数组</h3><p>以 <strong>-</strong> 开头的行表示构成一个数组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- A</span><br><span class="line">- B</span><br><span class="line">- C</span><br></pre></td></tr></table></figure>

<p>YAML 支持多维数组，可以使用行内表示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key: [value1, value2, ...]</span><br></pre></td></tr></table></figure>

<p>数据结构的子成员是一个数组，则可以在该项下面缩进一个空格。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-</span><br><span class="line"> - A</span><br><span class="line"> - B</span><br><span class="line"> - C</span><br></pre></td></tr></table></figure>

<p>一个相对复杂的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">companies:</span><br><span class="line">    -</span><br><span class="line">        id: 1</span><br><span class="line">        name: company1</span><br><span class="line">        price: 200W</span><br><span class="line">    -</span><br><span class="line">        id: 2</span><br><span class="line">        name: company2</span><br><span class="line">        price: 500W</span><br></pre></td></tr></table></figure>

<p>意思是 companies 属性是一个数组，每一个数组元素又是由 id、name、price 三个属性构成。</p>
<p>数组也可以使用流式(flow)的方式表示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">companies: [&#123;id: 1,name: company1,price: 200W&#125;,&#123;id: 2,name: company2,price: 500W&#125;]</span><br></pre></td></tr></table></figure>

<h3 id="复合结构"><a href="#复合结构" class="headerlink" title="复合结构"></a>复合结构</h3><p>数组和对象可以构成复合结构，例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">languages:</span><br><span class="line">  - Ruby</span><br><span class="line">  - Perl</span><br><span class="line">  - Python </span><br><span class="line">websites:</span><br><span class="line">  YAML: yaml.org </span><br><span class="line">  Ruby: ruby-lang.org </span><br><span class="line">  Python: python.org </span><br><span class="line">  Perl: use.perl.org</span><br></pre></td></tr></table></figure>

<p>转换为 json 为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  languages: [ &#x27;Ruby&#x27;, &#x27;Perl&#x27;, &#x27;Python&#x27;],</span><br><span class="line">  websites: &#123;</span><br><span class="line">    YAML: &#x27;yaml.org&#x27;,</span><br><span class="line">    Ruby: &#x27;ruby-lang.org&#x27;,</span><br><span class="line">    Python: &#x27;python.org&#x27;,</span><br><span class="line">    Perl: &#x27;use.perl.org&#x27; </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="纯量"><a href="#纯量" class="headerlink" title="纯量"></a>纯量</h3><p>纯量是最基本的，不可再分的值，包括：</p>
<ul>
<li>字符串</li>
<li>布尔值</li>
<li>整数</li>
<li>浮点数</li>
<li>Null</li>
<li>时间</li>
<li>日期</li>
</ul>
<p>使用一个例子来快速了解纯量的基本使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">boolean: </span><br><span class="line">    - TRUE  #true,True都可以</span><br><span class="line">    - FALSE  #false，False都可以</span><br><span class="line">float:</span><br><span class="line">    - 3.14</span><br><span class="line">    - 6.8523015e+5  #可以使用科学计数法</span><br><span class="line">int:</span><br><span class="line">    - 123</span><br><span class="line">    - 0b1010_0111_0100_1010_1110    #二进制表示</span><br><span class="line">null:</span><br><span class="line">    nodeName: &#x27;node&#x27;</span><br><span class="line">    parent: ~  #使用~表示null</span><br><span class="line">string:</span><br><span class="line">    - 哈哈</span><br><span class="line">    - &#x27;Hello world&#x27;  #可以使用双引号或者单引号包裹特殊字符</span><br><span class="line">    - newline</span><br><span class="line">      newline2    #字符串可以拆成多行，每一行会被转化成一个空格</span><br><span class="line">date:</span><br><span class="line">    - 2018-02-17    #日期必须使用ISO 8601格式，即yyyy-MM-dd</span><br><span class="line">datetime: </span><br><span class="line">    -  2018-02-17T15:02:31+08:00    #时间使用ISO 8601格式，时间和日期之间使用T连接，最后使用+代表时区</span><br></pre></td></tr></table></figure>

<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p><strong>&amp;</strong> 锚点和 ***** 别名，可以用来引用:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">defaults: &amp;defaults</span><br><span class="line">  adapter:  postgres</span><br><span class="line">  host:     localhost</span><br><span class="line"></span><br><span class="line">development:</span><br><span class="line">  database: myapp_development</span><br><span class="line">  &lt;&lt;: *defaults</span><br><span class="line"></span><br><span class="line">test:</span><br><span class="line">  database: myapp_test</span><br><span class="line">  &lt;&lt;: *defaults</span><br></pre></td></tr></table></figure>

<p>相当于:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">defaults:</span><br><span class="line">  adapter:  postgres</span><br><span class="line">  host:     localhost</span><br><span class="line"></span><br><span class="line">development:</span><br><span class="line">  database: myapp_development</span><br><span class="line">  adapter:  postgres</span><br><span class="line">  host:     localhost</span><br><span class="line"></span><br><span class="line">test:</span><br><span class="line">  database: myapp_test</span><br><span class="line">  adapter:  postgres</span><br><span class="line">  host:     localhost</span><br></pre></td></tr></table></figure>

<p><strong>&amp;</strong> 用来建立锚点（defaults），**&lt;&lt;** 表示合并到当前数据，***** 用来引用锚点。</p>
<p>下面是另一个例子:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- &amp;showell Steve </span><br><span class="line">- Clark </span><br><span class="line">- Brian </span><br><span class="line">- Oren </span><br><span class="line">- *showell </span><br></pre></td></tr></table></figure>

<p>转为 JavaScript 代码如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ &#x27;Steve&#x27;, &#x27;Clark&#x27;, &#x27;Brian&#x27;, &#x27;Oren&#x27;, &#x27;Steve&#x27; ]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考地址：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2016/07/yaml.html">https://www.ruanyifeng.com/blog/2016/07/yaml.html</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/97222440cd08">https://www.jianshu.com/p/97222440cd08</a></li>
<li><a target="_blank" rel="noopener" href="https://daihainidewo.github.io/blog/yaml%E6%95%99%E7%A8%8B/">https://daihainidewo.github.io/blog/yaml%E6%95%99%E7%A8%8B/</a></li>
</ul>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://mgrsc.github.io">Mgrsc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://mgrsc.github.io/undefinedDocker-0/">http://mgrsc.github.io/undefinedDocker-0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://mgrsc.github.io" target="_blank">Herbal's Lover</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%B9%E5%99%A8/">容器</a><a class="post-meta__tags" href="/tags/docker/">docker</a><a class="post-meta__tags" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a></div><div class="post_share"><div class="social-share" data-image="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-03-21%20161354.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">我是學生,V我50</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/alipay.jpg" alt="支付寶"/></a><div class="post-qr-code-desc">支付寶</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/undefineddaily/" title="Daily_English"><img class="cover" src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/Cursed%20Poem%20by%20Santiago%20Caruso.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Daily_English</div></div></a></div><div class="next-post pull-right"><a href="/undefinedOkkultismus/" title="Okkultismus"><img class="cover" src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/img/Robert%20Ryan,%20North%20American%20Gnostic%20Book%20of%20The%20Living,%202018.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Okkultismus</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="author_top is-center"><div class="card-info-avatar"><div class="avatar-img"><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/cat.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-status-box"><div class="author-status"><g-emoji class="g-emoji" alias="palm_tree" fallback-src="https://lskypro.acozycotage.net/LightPicture/2022/12/fe1dc0402e623096.jpg">🐱‍👤</g-emoji><span>隐身中</span></div></div></div><div class="author-info__name">Mgrsc</div><div class="author-info__description">Herb garden</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Mgrsc"><i class="fab fa-github"></i><span>github go!</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mgrsc" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:cnnordisk@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Herb garden</div><div id="welcome-info"></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#docker"><span class="toc-number">1.</span> <span class="toc-text">docker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87"><span class="toc-number">1.2.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF"><span class="toc-number">1.3.</span> <span class="toc-text">技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#namespace%EF%BC%88%E9%9A%94%E7%A6%BB%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">namespace（隔离）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cgroups%EF%BC%88%E9%99%90%E5%88%B6%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">Cgroups（限制）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rootfs"><span class="toc-number">1.3.3.</span> <span class="toc-text">rootfs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UnionFS"><span class="toc-number">1.3.4.</span> <span class="toc-text">UnionFS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AuFS"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">AuFS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.5.</span> <span class="toc-text">核心原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E7%9A%84%E7%BB%84%E4%BB%B6"><span class="toc-number">1.4.</span> <span class="toc-text">docker的组件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Docker%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.4.0.0.1.</span> <span class="toc-text">Docker的核心组件：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Docker%E7%9A%84%E6%8A%80%E6%9C%AF%E7%BB%84%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.4.0.0.2.</span> <span class="toc-text">Docker的技术组件：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.0.0.3.</span> <span class="toc-text">docker工作流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.4.0.0.4.</span> <span class="toc-text">docker的底层实现</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.</span> <span class="toc-text">Docker的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.1.</span> <span class="toc-text">Docker容器使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-run"><span class="toc-number">1.5.1.0.1.</span> <span class="toc-text">docker run</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-logs"><span class="toc-number">1.5.1.0.2.</span> <span class="toc-text">docker logs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-stop-amp-amp-docker-skill"><span class="toc-number">1.5.1.0.3.</span> <span class="toc-text">docker stop &amp;&amp; docker skill</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-inspect"><span class="toc-number">1.5.1.0.4.</span> <span class="toc-text">docker inspect</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-ps"><span class="toc-number">1.5.1.0.5.</span> <span class="toc-text">docker ps</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-attach"><span class="toc-number">1.5.1.0.6.</span> <span class="toc-text">docker attach</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-logs-1"><span class="toc-number">1.5.1.0.7.</span> <span class="toc-text">docker logs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-top"><span class="toc-number">1.5.1.0.8.</span> <span class="toc-text">docker top</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-stats"><span class="toc-number">1.5.1.0.9.</span> <span class="toc-text">docker stats</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-start-x2F-stop-x2F-restart"><span class="toc-number">1.5.1.0.10.</span> <span class="toc-text">docker start&#x2F;stop&#x2F;restart</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-exec"><span class="toc-number">1.5.1.0.11.</span> <span class="toc-text">docker exec</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-rm"><span class="toc-number">1.5.1.0.12.</span> <span class="toc-text">docker rm</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8F"><span class="toc-number">1.5.2.</span> <span class="toc-text">Docker镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-images"><span class="toc-number">1.5.2.0.1.</span> <span class="toc-text">docker images</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-pull"><span class="toc-number">1.5.2.0.2.</span> <span class="toc-text">docker pull</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-search"><span class="toc-number">1.5.2.0.3.</span> <span class="toc-text">docker search</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-commit"><span class="toc-number">1.5.2.0.4.</span> <span class="toc-text">docker commit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-rmi"><span class="toc-number">1.5.2.0.5.</span> <span class="toc-text">docker rmi</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dockerfire"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">dockerfire</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#FROM"><span class="toc-number">1.5.2.1.1.</span> <span class="toc-text">FROM</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#RUN"><span class="toc-number">1.5.2.1.2.</span> <span class="toc-text">RUN</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CMD"><span class="toc-number">1.5.2.1.3.</span> <span class="toc-text">CMD</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ENTRYPOINT"><span class="toc-number">1.5.2.1.4.</span> <span class="toc-text">ENTRYPOINT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#WORKDIR"><span class="toc-number">1.5.2.1.5.</span> <span class="toc-text">WORKDIR</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ENV"><span class="toc-number">1.5.2.1.6.</span> <span class="toc-text">ENV</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#USER"><span class="toc-number">1.5.2.1.7.</span> <span class="toc-text">USER</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#VOLUME"><span class="toc-number">1.5.2.1.8.</span> <span class="toc-text">VOLUME</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ADD"><span class="toc-number">1.5.2.1.9.</span> <span class="toc-text">ADD</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#COPY"><span class="toc-number">1.5.2.1.10.</span> <span class="toc-text">COPY</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#LABEL"><span class="toc-number">1.5.2.1.11.</span> <span class="toc-text">LABEL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#STOPSIGNAL"><span class="toc-number">1.5.2.1.12.</span> <span class="toc-text">STOPSIGNAL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ARG"><span class="toc-number">1.5.2.1.13.</span> <span class="toc-text">ARG</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ONBUILD"><span class="toc-number">1.5.2.1.14.</span> <span class="toc-text">ONBUILD</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-build"><span class="toc-number">1.5.2.1.15.</span> <span class="toc-text">docker build</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-history"><span class="toc-number">1.5.2.1.16.</span> <span class="toc-text">docker history</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#dockers-port"><span class="toc-number">1.5.2.1.17.</span> <span class="toc-text">dockers port</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-pull-1"><span class="toc-number">1.5.2.1.18.</span> <span class="toc-text">docker pull</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-push"><span class="toc-number">1.5.2.1.19.</span> <span class="toc-text">docker push</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-tag"><span class="toc-number">1.5.2.1.20.</span> <span class="toc-text">docker tag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%AE%B9%E5%99%A8%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.5.3.</span> <span class="toc-text">Docker容器连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">网络端口映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-%E5%AE%B9%E5%99%A8%E4%BA%92%E8%81%94"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">Docker 容器互联</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#docekr-%E2%80%93link"><span class="toc-number">1.5.3.2.1.</span> <span class="toc-text">docekr –link</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-network"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">docker network</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-network-create"><span class="toc-number">1.5.3.3.1.</span> <span class="toc-text">docker  network create</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-connect-%E7%BD%91%E7%BB%9C-%E5%AE%B9%E5%99%A8"><span class="toc-number">1.5.3.3.2.</span> <span class="toc-text">docker connect  网络 容器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docker-disconnect-%E7%BD%91%E7%BB%9C-%E5%AE%B9%E5%99%A8"><span class="toc-number">1.5.3.3.3.</span> <span class="toc-text">docker disconnect 网络 容器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-%E7%BC%96%E6%8E%92"><span class="toc-number">1.5.4.</span> <span class="toc-text">Docker 编排</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DockerCompose"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">DockerCompose</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%EF%BC%88Swarm"><span class="toc-number">1.5.5.</span> <span class="toc-text">Docker 集群管理（Swarm)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-API"><span class="toc-number">1.5.6.</span> <span class="toc-text">Docker API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-Remote-API"><span class="toc-number">1.5.6.1.</span> <span class="toc-text">Docker Remote API</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#YAML"><span class="toc-number">1.6.</span> <span class="toc-text">YAML</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">1.6.1.</span> <span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#YAML-%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.6.3.</span> <span class="toc-text">YAML 对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#YAML-%E6%95%B0%E7%BB%84"><span class="toc-number">1.6.4.</span> <span class="toc-text">YAML 数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E7%BB%93%E6%9E%84"><span class="toc-number">1.6.5.</span> <span class="toc-text">复合结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%AF%E9%87%8F"><span class="toc-number">1.6.6.</span> <span class="toc-text">纯量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8"><span class="toc-number">1.6.7.</span> <span class="toc-text">引用</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/undefinedshuju2/" title="数据结构(2)线性结构"><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/img/image-20230413113253807.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构(2)线性结构"/></a><div class="content"><a class="title" href="/undefinedshuju2/" title="数据结构(2)线性结构">数据结构(2)线性结构</a><time datetime="2023-04-14T07:55:44.000Z" title="发表于 2023-04-14 15:55:44">2023-04-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefinedshuju/" title="数据结构（1）基础知识"><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/img/image-20230412103141581.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构（1）基础知识"/></a><div class="content"><a class="title" href="/undefinedshuju/" title="数据结构（1）基础知识">数据结构（1）基础知识</a><time datetime="2023-04-13T06:01:49.000Z" title="发表于 2023-04-13 14:01:49">2023-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefineddaily/" title="Daily_English"><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/Cursed%20Poem%20by%20Santiago%20Caruso.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Daily_English"/></a><div class="content"><a class="title" href="/undefineddaily/" title="Daily_English">Daily_English</a><time datetime="2023-03-22T05:13:07.000Z" title="发表于 2023-03-22 13:13:07">2023-03-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefinedDocker-0/" title="Docker"><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-03-21%20161354.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker"/></a><div class="content"><a class="title" href="/undefinedDocker-0/" title="Docker">Docker</a><time datetime="2023-03-21T08:14:37.000Z" title="发表于 2023-03-21 16:14:37">2023-03-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefinedOkkultismus/" title="Okkultismus"><img src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/img/Robert%20Ryan,%20North%20American%20Gnostic%20Book%20of%20The%20Living,%202018.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Okkultismus"/></a><div class="content"><a class="title" href="/undefinedOkkultismus/" title="Okkultismus">Okkultismus</a><time datetime="2023-03-17T05:10:03.000Z" title="发表于 2023-03-17 13:10:03">2023-03-17</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Mgrsc</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><div class="js-pjax"></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script src="/js/sun_moon.js" async></script><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async data-pjax src="/js/txmap.js"></script><script async src="/js/title.js"></script><script async src="https://npm.elemecdn.com/tzy-blog/lib/js/other/sakura.js"></script><script async src="//at.alicdn.com/t/c/font_3946756_hoh0vr6qygb.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><!-- hexo injector body_end start --><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;undefinedwangbuliuxing/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/wblx.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-16</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;undefinedwangbuliuxing/&quot;);" href="javascript:void(0);" alt="">王不留行</a><div class="blog-slider__text">味苦、甘，平，无毒， 止血</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;undefinedwangbuliuxing/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;undefinedlamb/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/book%20of%20lambspring%20(1607)-p1-1.JPG" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-15</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;undefinedlamb/&quot;);" href="javascript:void(0);" alt="">Book of Lambspring</a><div class="blog-slider__text">炼金术之羔羊之书</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;undefinedlamb/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;undefineddaily/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/Cursed%20Poem%20by%20Santiago%20Caruso.jpeg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-22</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;undefineddaily/&quot;);" href="javascript:void(0);" alt="">Daily_English</a><div class="blog-slider__text">每天学习英语 good good study; day day up</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;undefineddaily/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;undefinedOkkultismus/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/img/Robert%20Ryan,%20North%20American%20Gnostic%20Book%20of%20The%20Living,%202018.jpeg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-17</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;undefinedOkkultismus/&quot;);" href="javascript:void(0);" alt="">Okkultismus</a><div class="blog-slider__text">Okkultismus</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;undefinedOkkultismus/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;undefinedDocker-0/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-03-21%20161354.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-21</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;undefinedDocker-0/&quot;);" href="javascript:void(0);" alt="">Docker</a><div class="blog-slider__text">高效，简单的沙盒技术，data+process=image</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;undefinedDocker-0/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;undefinedchonglou/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://blog-1309914759.cos.ap-guangzhou.myqcloud.com/web/Paris_polyphylla_PICT6023.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-16</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;undefinedchonglou/&quot;);" href="javascript:void(0);" alt="">七叶一枝花</a><div class="blog-slider__text">佤族之圣药，性微寒，微苦辛，小毒</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;undefinedchonglou/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><!-- hexo injector body_end end --></body></html>